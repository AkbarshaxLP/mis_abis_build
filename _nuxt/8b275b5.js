(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{1e3:function(e,t,n){"use strict";n.r(t);n(8),n(7),n(9),n(10);var r=n(0),l=(n(2),n(6),n(4),n(22),n(14),n(47),n(76),n(171),n(12),n(25),n(35)),c=n(5),o=n.n(c);function m(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function d(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?m(Object(source),!0).forEach((function(t){Object(r.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):m(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var h={props:["grade"],computed:d(d({},Object(l.b)("dictionary",["dic_branch","dic_academic_year","dic_grade","dic_role"])),{},{semester_list:function(){var e=this,data=[];return this.dic_academic_year.forEach((function(element){element.current_academicyear&&(e.filter.academic_year=element.id,element.semesters.forEach((function(t){t.current_semester&&(e.filter.semester=t.id)})),data=element.semesters)})),data},cur_academic_year:function(){var data="";return this.dic_academic_year.forEach((function(element){element.current_academicyear&&(data=element.id)})),data},cur_semester:function(){var e=this,data="";return this.dic_academic_year.forEach((function(element){element.current_academicyear&&(e.filter.academic_year=element.id,element.semesters.forEach((function(e){e.current_semester&&(data=e.id)})))})),data},dic_list:function(){return this.TimeTabledic&&this.TimeTabledic.length?this.TimeTabledic.filter((function(element){return"Lesson"==element.type})):[]},role:function(){var e;return null===(e=this.$store.state.auth.user)||void 0===e?void 0:e.role.name}}),data:function(){return{title:"Timetable",items:[{text:"Timetable",href:"/timetable"},{text:"Group",active:!0}],loader:!1,TimeTableGroup:{},TimeTabledic:{},filter:{},Leesons:[],semester:"",academic_year:"",timeTableList:[],a:[],time_table_id:"",time_table_base:{id:7,academic_year:{id:11,name:"2022-2023"},semester:{id:13,start_semester:"05.09.2022",end_semester:"10.11.2022"},group:{id:23,name:"3 A"},etimetablelesson:[{weekday:"Monday",timetable:[{weekday:"Monday",etimetable:7,para:"",lesson:"",edit:!0,loading:!1}]},{weekday:"Tuesday",timetable:[{weekday:"Tuesday",etimetable:7,para:"",lesson:"",edit:!0,loading:!1}]},{weekday:"Wednesday",timetable:[{weekday:"Wednesday",etimetable:7,para:"",lesson:"",edit:!0,loading:!1}]},{weekday:"Thursday",timetable:[{weekday:"Thursday",etimetable:7,para:"",lesson:"",edit:!0,loading:!1}]},{weekday:"Friday",timetable:[{weekday:"Friday",etimetable:7,para:"",lesson:"",edit:!0,loading:!1}]},{weekday:"Saturday",timetable:[{weekday:"Saturday",etimetable:7,para:"",lesson:"",edit:!0,loading:!1}]}]}}},watch:{grade:function(){this._gettimetableDic()},semester:function(){this._getList()}},methods:{_getList:function(){var e=this;this.loader=!0,this.semester=this.semester?this.semester:this.cur_semester,this.academic_year=this.academic_year?this.academic_year:this.cur_academic_year,this.$axios.get("/etimetablelist/?academic_year=".concat(this.academic_year,"&semester=").concat(this.semester,"&group=").concat(this.$route.params.id)).then((function(t){if(e.a=t.data,t.data&&t.data.etimetablelesson){var n=[];e.time_table_id=t.data.id,t.data.etimetablelesson.forEach((function(element){if(null==element.timetable)n.push({weekday:element.weekday,timetable:[{weekday:element.weekday,etimetable:t.data.id,para:"",lesson:"",edit:!0,loading:!1}]});else{var r=[];element.timetable.forEach((function(e){r.push(d(d({},e),{},{lesson:e.lesson.id,subject_name:e.lesson.subject_name,main_teacher:e.lesson.main_teacher,teacher:e.lesson.teacher,edit:!1,loading:!1}))})),r=e.SortPara(r),n.push({weekday:element.weekday,timetable:r})}})),t.data.etimetablelesson=n,e.TimeTableGroup=t.data,e.generateTimeTable()}else["branch_admin"].includes(e.role)?e.CreateTimeTableFirst():(e.TimeTableGroup=e.time_table_base,e.generateTimeTable())})).catch((function(){e.loader=!1}))},SortPara:function(e){return e.sort((function(a,b){return a.para>b.para?1:-1}))},_gettimetableDic:function(){var e=this;this.loader=!0,this.$axios.get("/timetabledict/").then((function(t){var data=[];t.data.results.forEach((function(t){t.grade.forEach((function(n){n.name==e.grade&&(data=t.dicttime)}))})),e.TimeTabledic=data,e._getList()})).catch((function(){e.loader=!1}))},IssetPara:function(e){var data=[];return e.forEach((function(element){data.push(element.para)})),data},SubjectName:function(e){var data=e.subject_name;return e.main_teacher&&e.main_teacher.first_name&&(data=data+" | "+e.main_teacher.last_name+" "+e.main_teacher.first_name+" "+e.main_teacher.middle_name),data},getsubjects:function(){var e=this;this.loadingsubject=!0,this.$axios.get("/lesson/?group=".concat(this.$route.params.id,"&limit=1000")).then((function(t){e.Leesons=t.data.results})).finally((function(){e.loadingsubject=!1}))},generateTimeTable:function(){var e=this,t=[],n=new Date;n=o()(n).format("dddd"),this.TimeTabledic&&this.TimeTabledic.length&&this.TimeTableGroup&&this.TimeTableGroup.etimetablelesson&&this.TimeTableGroup.etimetablelesson.forEach((function(r){var data={weekday:r.weekday,current_day:r.weekday==n,timetable:[]};e.TimeTabledic.forEach((function(e){"Lesson"!=e.type?data.timetable.push({start_time:e.start_time,end_time:e.end_time,para:e.para,lesson:e.type,subject_name:e.type,color:"color-"+e.type.toLowerCase(),edit:!1,loading:!1}):r.timetable.forEach((function(t){t.para==e.para&&data.timetable.push({id:t.id,start_time:e.start_time,end_time:e.end_time,para:e.para,lesson:t.lesson,subject_name:t.subject_name,color:"color-"+t.subject_name.charAt(0).toLowerCase(),main_teacher:t.main_teacher,teacher:t.timeTableList,edit:!1,loading:!1,delete:!1,type:"Lesson"})}))})),t.push(data)})),this.timeTableList=t,this.loader=!1},SaveEdit:function(e,t,n,i,r){var l=this;if(n.lesson&&n.para){var data=new FormData;this.timeTableList[i].timetable[r].loading=!0,data.append("etimetable",e),data.append("lesson",n.lesson),data.append("para",n.para),data.append("weekday",t),n.id?this.$axios.put("/etimetablelesson/".concat(n.id,"/"),data).catch((function(){})).finally((function(){l.timeTableList[i].timetable[r].subject_name=l.GetSubjectByName(n,"subject_name"),l.timeTableList[i].timetable[r].color="color-"+l.timeTableList[i].timetable[r].subject_name.charAt(0).toLowerCase(),l.timeTableList[i].timetable[r].main_teacher=l.GetSubjectByName(n,"main_teacher").first_name+" "+l.GetSubjectByName(n,"main_teacher").last_name+" "+l.GetSubjectByName(n,"main_teacher").middle_name,l.timeTableList[i].timetable[r].edit=!1,l.timeTableList[i].timetable[r].loading=!1,l.timeTableList[i].timetable=l.SortTimeTable(l.timeTableList[i].timetable)})):this.$axios.post("/etimetablelesson/",data).then((function(e){l.timeTableList[i].timetable[r].start_time=l.GetDicPara(l.timeTableList[i].timetable[r],"start_time"),l.timeTableList[i].timetable[r].id=e.data.id})).catch((function(){})).finally((function(){l.timeTableList[i].timetable[r].subject_name=l.GetSubjectByName(n,"subject_name"),l.timeTableList[i].timetable[r].color="color-"+l.timeTableList[i].timetable[r].subject_name.charAt(0).toLowerCase(),l.timeTableList[i].timetable[r].main_teacher=l.GetSubjectByName(n,"main_teacher").first_name+" "+l.GetSubjectByName(n,"main_teacher").last_name+" "+l.GetSubjectByName(n,"main_teacher").middle_name,l.timeTableList[i].timetable[r].edit=!1,l.timeTableList[i].timetable[r].loading=!1,l.timeTableList[i].timetable=l.SortTimeTable(l.timeTableList[i].timetable)}))}else this.$Swal.fire({title:"Please fill fields!",type:"warning",confirmButtonText:"Ok",confirmButtonClass:"btn btn-success mt-2"})},GetSubjectByName:function(e,t){if("Lesson"==e.type){var data=e[t];return this.Leesons.forEach((function(element){element.id==e.lesson&&(data=element[t])})),data}return e.lesson},DeleteTimeTableList:function(e,i,t){var n=this;e?(this.timeTableList[i].timetable[t].delete=!0,this.$axios.delete("/etimetablelesson/".concat(e,"/")).then((function(){n.timeTableList[i].timetable.splice(t,1)})).catch((function(){}))):this.timeTableList[i].timetable.splice(t,1)},SortTimeTable:function(e){return e.sort((function(a,b){return a.para>b.para?1:-1}))},AddTimeTable:function(i){this.timeTableList[i].timetable.push({start_time:"",end_time:"",para:"",lesson:"",subject_name:"",main_teacher:"",teacher:"",edit:!0,loading:!1,delete:!1,type:"Lesson"})},GetDicPara:function(e,t){var data="--:--";return e.para?(this.TimeTabledic.forEach((function(element){element.para==e.para&&(data=element[t])})),data):data},disabled_para_list:function(e){var data=[];return e.forEach((function(element){data.push(element.para)})),data},CreateTimeTableFirst:function(){var e=this,data=new FormData;data.append("academic_year",this.academic_year),data.append("semester",this.semester),data.append("group",this.$route.params.id),this.$axios.post("/etimetable/",data).then((function(){e._getList()}))},checkCurDate:function(e){if(["branch_admin"].includes(this.role))return!0;var t=new Date;return(t=o()(t).format("YYYY-MM-DD"))>=o()(this.formatDate(e)).format("YYYY-MM-DD")},formatDate:function(e){if(e){var a=e.split(".");return a=a[2]+"-"+a[1]+"-"+a[0]}},generatePara:function(e,t){var i=0;return this.TimeTabledic.forEach((function(element){"Lesson"!=element.type&&element.para<e&&(i+=1)})),t?e-i:e+i}},mounted:function(){this.getsubjects(),this.grade&&this._gettimetableDic(),this.cur_semester&&(this.semester=this.cur_semester),this.cur_academic_year&&(this.academic_year=this.cur_academic_year)}},_=(n(988),n(16)),component=Object(_.a)(h,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"time-table-group"},[n("b-card-text",[n("header",{staticClass:"d-flex align-items-center justify-content-between mb-3"},[n("h4",{staticClass:"m-0"},[e._v("Timetable")]),e._v(" "),n("div",{staticClass:"d-flex align-items-center"},[n("el-select",{staticClass:"  foniy-select mr-1",attrs:{placeholder:"Academic year"},model:{value:e.academic_year,callback:function(t){e.academic_year=t},expression:"academic_year"}},e._l(e.dic_academic_year,(function(t,i){return n("el-option",{key:i,attrs:{label:t.name,value:t.id,disabled:!e.checkCurDate(t.start_semester)}})})),1),e._v(" "),n("el-select",{staticClass:"  foniy-select mr-1",attrs:{placeholder:"Term"},model:{value:e.semester,callback:function(t){e.semester=t},expression:"semester"}},e._l(e.semester_list,(function(t,i){return n("el-option",{key:i,attrs:{label:i+1+"-term",value:t.id,disabled:!e.checkCurDate(t.start_semester)}})})),1)],1)]),e._v(" "),n("div",{staticClass:"time-table-view"},[e.timeTableList&&e.timeTableList.length&&!e.loader?n("div",{staticClass:"time-table-view-items"},e._l(e.timeTableList,(function(t,i){return n("div",{key:i,staticClass:"time-table-view-item foniy-table"},[n("div",{staticClass:"foniy-table"},[n("table",{staticClass:"border-all"},[n("tr",{class:t.current_day?"bg-promary-light":"bg-primary"},[n("th",{staticClass:"text-center font-weight-bold",attrs:{colspan:"5"}},[e._v("\n                                    "+e._s(t.weekday)+"\n                                ")])]),e._v(" "),n("tr",{staticClass:"bg-gray"},[n("th",{staticClass:"text-center font-weight-bold",staticStyle:{width:"80px"}}),e._v(" "),n("th",{staticClass:"text-center font-weight-bold",staticStyle:{width:"200px"}},[e._v("Lesson ")]),e._v(" "),n("th",{staticClass:"text-center font-weight-bold",staticStyle:{width:"200px"}},[e._v("Teacher ")]),e._v(" "),n("th",{staticClass:"text-center font-weight-bold",staticStyle:{width:"150px"}},[e._v("Start/End ")]),e._v(" "),["branch_admin"].includes(e.role)?n("th",{staticClass:"text-center font-weight-bold",staticStyle:{width:"80px"}},[e._v("Action")]):e._e()]),e._v(" "),e._l(t.timetable,(function(r,l){return n("tr",{key:l},[n("td",{staticClass:"text-center"},[r.edit?n("el-select",{staticClass:"w-full",attrs:{disabled:!r.edit,placeholder:"Para"},model:{value:r.para,callback:function(t){e.$set(r,"para",t)},expression:"item2.para"}},e._l(e.dic_list,(function(r,l){return n("el-option",{key:r.id,attrs:{disabled:e.disabled_para_list(t.timetable).includes(r.para),label:l+1,value:r.para}})})),1):n("p",{staticClass:"m-0"},["Lesson"==r.type?n("span",{staticClass:"font-weight-bold"},[e._v(e._s(e.generatePara(r.para,!0))+"  ")]):e._e()])],1),e._v(" "),n("td",{staticClass:"text-center"},[r.edit?n("el-select",{staticClass:"w-full",attrs:{disabled:!r.edit,filterable:"","reserve-keyword":"",placeholder:"Lesson"},model:{value:r.lesson,callback:function(t){e.$set(r,"lesson",t)},expression:"item2.lesson"}},e._l(e.Leesons,(function(t){return n("el-option",{key:t.id,attrs:{label:e.SubjectName(t),value:t.id}})})),1):n("p",{staticClass:"m-0 "},[n("span",{staticClass:"font-weight-bold general-lesson-name",class:r.color},["Lunch"==r.lesson?n("i",{staticClass:"mdi mdi-coffee mr-1"}):e._e(),e._v(" "),"Snack"==r.lesson?n("i",{staticClass:"mdi mdi-cupcake mr-1"}):e._e(),e._v("\n                                            "+e._s(r.subject_name)+" \n                                        ")])])],1),e._v(" "),n("td",{staticClass:"text-center font-weight-bold"},[r.main_teacher?n("span",{staticClass:"font-14 pt-1 ml-2 color-primary"},[e._v(" "+e._s(r.main_teacher)+" ")]):e._e()]),e._v(" "),n("td",{staticClass:"text-center font-weight-bold"},[n("p",{staticClass:"time-colors"},[e._v(" "+e._s(e.GetDicPara(r,"start_time"))+" / "+e._s(e.GetDicPara(r,"end_time"))+" ")])]),e._v(" "),["branch_admin"].includes(e.role)?n("td",{staticStyle:{width:"70px"}},["Lesson"==r.type?n("div",{staticClass:"d-flex justify-content-between"},[r.edit||r.loading?e._e():n("button",{staticClass:"button simple font-16 font-weight-bold mr-1",on:{click:function(e){r.edit=!0}}},[n("i",{staticClass:"mdi mdi-pencil"})]),e._v(" "),r.edit&&!r.loading?n("button",{staticClass:"button simple font-16 font-weight-bold mr-1 color-green",on:{click:function(n){return e.SaveEdit(e.time_table_id,t.weekday,r,i,l)}}},[n("i",{staticClass:"mdi mdi-check-bold"})]):e._e(),e._v(" "),r.loading?n("button",{staticClass:"button simple font-16 font-weight-bold mr-1 color-green",attrs:{disabled:""}},[n("i",{staticClass:"el-icon-loading"})]):e._e(),e._v(" "),r.delete?n("button",{staticClass:"button simple font-16 font-weight-bold color-red"},[n("i",{staticClass:"el-icon-loading"})]):n("div",[r.id?n("el-popconfirm",{attrs:{"confirm-button-text":"OK","cancel-button-text":"No, Thanks",title:"Are you sure to delete this?"},on:{confirm:function(t){return e.DeleteTimeTableList(r.id,i,l)}}},[n("button",{staticClass:"button simple font-16 font-weight-bold color-red",attrs:{slot:"reference"},slot:"reference"},[n("i",{staticClass:"mdi mdi-close-thick"})])]):n("button",{staticClass:"button simple font-16 font-weight-bold color-red",attrs:{slot:"reference"},on:{click:function(t){return e.DeleteTimeTableList(r.id,i,l)}},slot:"reference"},[n("i",{staticClass:"mdi mdi-close-thick"})])],1)]):e._e()]):e._e()])})),e._v(" "),["branch_admin"].includes(e.role)&&t.timetable&&e.TimeTabledic&&t.timetable.length<e.TimeTabledic.length?n("tr",[n("td",{attrs:{colspan:"5"}},[n("b-button",{staticClass:"ml-1 font-20 font-weight-bold w-full",attrs:{size:"md",variant:"outline-success"},on:{click:function(t){return e.AddTimeTable(i)}}},[n("i",{staticClass:"mdi mdi-plus-circle"})])],1)]):e._e()],2)])])})),0):e._e(),e._v(" "),e.loader?n("div",{staticClass:"table-loader",staticStyle:{height:"300px"}},[n("i",{staticClass:"el-icon-loading"}),e._v(" "),n("p",{staticClass:"m-0 mt-1"},[e._v("loading...")])]):e._e(),e._v(" "),!e.timeTableList||e.timeTableList.length||e.loader?e._e():n("div",{staticClass:"empty-time-table"},[n("p",{staticClass:"text-center"},[n("i",{staticClass:"mdi mdi-timer-outline font-20"}),e._v(" "),n("br"),e._v("\n                    Timetable has not created this group yet!\n                ")])])])])],1)}),[],!1,null,"69e34058",null);t.default=component.exports},908:function(e,t,n){var content=n(989);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(53).default)("61dcd6cc",content,!0,{sourceMap:!1})},988:function(e,t,n){"use strict";n(908)},989:function(e,t,n){var r=n(52)(!1);r.push([e.i,".time-table-view .time-table-view-items[data-v-69e34058]{display:flex;flex-wrap:wrap;margin-right:-10px;margin-left:-10px}.time-table-view .time-table-view-item[data-v-69e34058]{width:50%;padding:10px}.time-table-view .empty-time-table[data-v-69e34058]{width:100%;height:300px;display:flex;align-items:center;justify-content:center}",""]),e.exports=r}}]);