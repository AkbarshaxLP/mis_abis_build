(window.webpackJsonp=window.webpackJsonp||[]).push([[214,41],{1048:function(t,e,r){var content=r(1161);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(53).default)("e888e320",content,!0,{sourceMap:!1})},1160:function(t,e,r){"use strict";r(1048)},1161:function(t,e,r){var n=r(52)(!1);n.push([t.i,".school-create-form .item{margin-bottom:.5rem}",""]),t.exports=n},1309:function(t,e,r){"use strict";r.r(e);r(7),r(9),r(6),r(10);var n=r(0),o=(r(22),r(4),r(2),r(47),r(8),r(35));function l(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}function c(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?l(Object(source),!0).forEach((function(e){Object(n.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):l(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var d={head:function(){return{title:"".concat(this.title," | MIS tbteam.uz")}},data:function(){return{statusKeys:{new:"danger",started:"danger",finished:"danger"},edit:!1,loading:!1,perPage:null,attach_form:{group:null,student:[]},search_student:null,currentPage:1,currentPageGroup:1,totalRows:null,totalRowsGroup:null,form:{},filter:{},show:!1,title:"Groups",myLessons:[],items:[{text:"Groups",active:!0}],rows:{results:[]},students:{results:[]},group:{},showClassModal:!1,DIC_teacher:[]}},computed:c(c({},Object(o.b)("dictionary",["dic_branch","dic_academic_year","dic_grade","dic_role","dic_language"])),{},{role:function(){var t;return null===(t=this.$store.state.auth.user)||void 0===t?void 0:t.role.name},DIC_grade_options:function(){var t=this,a=[];return this.dic_grade.filter((function(e){e.id===t.group.grade&&(a=e.options)})),a}}),created:function(){this.__GET(),["branch_admin"].includes(this.role)&&this.getStudents(),["teacher"].includes(this.role)&&this.getMyLessons()},methods:{getMyLessons:function(){var t=this;this.loading=!0,this.$axios.get("/lesson/?my_lessons=1&limit=1000").then((function(e){t.myLessons=e.data.results})).finally((function(){t.loading=!1}))},clearForm:function(){},editGroup:function(){var t=this;this.$refs.group.validate().then((function(e){if(e){var r=t.group.id;t.$axios({method:r?"PATCH":"POST",url:r?"/group/".concat(r,"/"):"/group/",data:t.group}).then((function(e){t.$Swal.fire({title:"Group has been saved!",type:"success"}),t.showClassModal=!1,t.getGroups(),t.clearForm()})).catch((function(e){var r=e.response.data,n=Object.keys(r),o="string"==typeof r[n[0]]?r[n[0]]:r[n[0]][0];t.$Swal.fire({title:"Error",text:o||"error has occurred",type:"error"})})).finally((function(){t.loading=!1}))}}))},setForm:function(t){this.group=c({},t),this.edit=!0,this.group.academic_year=this.group.academic_year?this.group.academic_year.id:null,this.group.branch=this.group.branch?this.group.branch.id:null,this.group.grade=this.group.grade?this.group.grade.id:null,this.group.teacher=this.group.teacher?this.group.teacher.id:null,this.getTeachers()},getTeachers:function(){var t=this,e=this.returnRoleId("teacher");this.$axios({method:"GET",url:"/teachers/",params:{role:e}}).then((function(e){t.DIC_teacher=e.data})).finally((function(){t.loading=!1}))},returnRoleId:function(t){var a=null;return this.dic_role.filter((function(e){e.name===t&&(a=e.id)})),a},pageChanged:function(t){this.getStudents()},pageChangedGroup:function(){var t=this;this.$nextTick((function(){t.__GET()}))},save:function(){var t=this;this.$refs.form.validate().then((function(e){if(e){var a=[];t.loading=!0,t.attach_form.student.filter((function(e){a.push({group:t.attach_form.group,student:e})})),t.$axios.post("/student_add_group/",a).then((function(e){t.show=!1,t.getStudents(),t.$Swal.fire({title:"Success!",type:"success"})})).catch((function(e){var r=e.response.data,n=Object.keys(r),o="string"==typeof r[n[0]]?r[n[0]]:r[n[0]][0];t.$Swal.fire({title:"Error",text:o||"error has occurred",type:"error"})})).finally((function(){t.loading=!1}))}}))},filtering:function(){this.__GET()},__GET:function(){var t=this;this.loading=!0,this.$axios.get("/group/?my_groups=my_groups&page=".concat(this.currentPageGroup),{params:this.filter}).then((function(e){t.totalRowsGroup=e.data.count,t.rows.results=e.data.results})).finally((function(){t.loading=!1}))},getStudents:function(){var t=this;this.loading=!0;var filter={student_group:"not_added_to_the_group",page:this.currentPage,search:this.search_student};this.$axios.get("/users/student",{params:filter}).then((function(e){t.students=e.data,t.totalRows=e.data.count})).finally((function(){t.loading=!1}))},getNameOf:function(t,e){var a=null;return e.filter((function(e){e.id===t&&(a=e.name)})),a},deleteItem:function(t){var e=this;this.$confirm("Do you want delete this group?",{confirmButtonText:"Yes",cancelButtonText:"Cancel",type:"warning"}).then((function(){e.loading=!0,e.$axios.delete("/group/".concat(t,"/")).then((function(){e.__GET(),e.$message({type:"success",message:"Deleted"})})).catch((function(t){var r=t.response.data,n=Object.keys(r),o="string"==typeof r[n[0]]?r[n[0]]:r[n[0]][0];e.$Swal.fire({title:"Error",text:o||"error has occurred",type:"error"})})).finally((function(){e.loading=!1}))}))}},middleware:"auth"},_=(r(1160),r(16)),component=Object(_.a)(d,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[n("PageHeader",{attrs:{title:t.title,items:t.items}}),t._v(" "),["branch_admin"].includes(t.role)?n("div",{staticClass:"card"},[n("div",{staticClass:"card-body"},[n("div",{staticClass:"d-flex flex-wrap"},[n("div",{staticClass:"item mr-2"},[n("p",{staticClass:"mb-1"},[t._v("Branch")]),t._v(" "),n("b-select",{staticStyle:{width:"200px"},attrs:{placeholder:"Choose..."},on:{change:function(e){return t.__GET()}},model:{value:t.filter.branch,callback:function(e){t.$set(t.filter,"branch",e)},expression:"filter.branch"}},t._l(t.dic_branch,(function(e){return n("option",{key:e.id,attrs:{label:e.short_name},domProps:{value:e.id}},[t._v("\n                            "+t._s(e.short_name)+"\n                        ")])})),0)],1),t._v(" "),n("div",{staticClass:"item mr-2"},[n("p",{staticClass:"mb-1"},[t._v("Academic year")]),t._v(" "),n("b-select",{staticStyle:{width:"200px"},attrs:{placeholder:"Choose..."},on:{change:function(e){return t.__GET()}},model:{value:t.filter.academic_year,callback:function(e){t.$set(t.filter,"academic_year",e)},expression:"filter.academic_year"}},t._l(t.dic_academic_year,(function(e){return n("option",{key:e.id,attrs:{label:e.name},domProps:{value:e.id}},[t._v("\n                            "+t._s(e.name)+"\n                        ")])})),0)],1),t._v(" "),n("div",{staticClass:"item mr-2"},[n("p",{staticClass:"mb-1"},[t._v("Grade")]),t._v(" "),n("b-select",{staticStyle:{width:"200px"},attrs:{placeholder:"Choose..."},on:{change:function(e){return t.__GET()}},model:{value:t.filter.grade,callback:function(e){t.$set(t.filter,"grade",e)},expression:"filter.grade"}},t._l(t.dic_grade,(function(e){return n("option",{key:e.id,attrs:{label:e.name},domProps:{value:e.id}},[t._v("\n                            "+t._s(e.name)+"\n                        ")])})),0)],1),t._v(" "),n("div",{staticClass:"item mr-2"},[n("p",{staticClass:"mb-1"},[t._v("Search")]),t._v(" "),n("b-input",{staticStyle:{width:"200px"},attrs:{placeholder:"Search..."},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.__GET()}},model:{value:t.filter.search,callback:function(e){t.$set(t.filter,"search",e)},expression:"filter.search"}})],1),t._v(" "),n("div",{staticClass:"item d-flex"},[n("button",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"mt-auto btn btn-clear",attrs:{title:"Clear filter"},on:{click:function(e){t.filter={},t.__GET()}}},[n("i",{staticClass:"mdi mdi-broom text-lg-center"})])])])])]):t._e(),t._v(" "),n("div",{staticClass:"card"},[n("div",{staticClass:"card-body"},[["teacher"].includes(t.role)?n("h4",{staticClass:"header-title mb-3"},[t._v("\n                Class Teacher\n            ")]):t._e(),t._v(" "),n("div",{staticClass:"table-responsive"},[n("table",{staticClass:"table table-centered mb-0"},[n("thead",{staticClass:"font-13 bg-light text-muted"},[n("tr",[n("th",{staticClass:"font-weight-medium"},[t._v("Name")]),t._v(" "),n("th",{staticClass:"font-weight-medium"},[t._v("Branch")]),t._v(" "),n("th",{staticClass:"font-weight-medium"},[t._v("Students")]),t._v(" "),n("th",{staticClass:"font-weight-medium"},[t._v("Academic Year")]),t._v(" "),["branch_admin"].includes(t.role)?n("th",{staticStyle:{width:"80px"}},[t._v("Action")]):t._e()])]),t._v(" "),n("tbody",t._l(t.rows.results,(function(e){return n("tr",{key:e.id},[n("td",{staticClass:" font-13 color-primary text-underline font-weight-bold",staticStyle:{width:"140px"}},[n("nuxt-link",{attrs:{to:"/groups/students/"+e.id}},[t._v(t._s(e.name))])],1),t._v(" "),n("td",{staticClass:"text-muted font-13"},[t._v("\n                                "+t._s(e.branch.short_name)+" \n                            ")]),t._v(" "),n("td",{staticClass:"text-muted font-13"},[t._v("\n                                "+t._s(e.student_count)+"\n                            ")]),t._v(" "),n("td",{staticClass:"text-muted font-13"},[t._v(t._s(e.academic_year?e.academic_year.name:"")+"\n                            ")]),t._v(" "),["branch_admin"].includes(t.role)?n("td",[n("img",{staticClass:"cursor-pointer mr-2",attrs:{src:r(839)},on:{click:function(r){t.showClassModal=!0,t.setForm(e)}}}),t._v(" "),n("button",{staticClass:"button simple",attrs:{disabled:0==!e.student_count},on:{click:function(r){return t.deleteItem(e.id)}}},[n("i",{staticClass:"el-icon-delete cursor-pointer text-red-600"})])]):t._e()])})),0)])]),t._v(" "),n("div",{staticClass:"d-flex justify-content-end w-full"},[n("b-pagination",{attrs:{"total-rows":t.totalRowsGroup,"per-page":10},on:{change:t.pageChangedGroup},model:{value:t.currentPageGroup,callback:function(e){t.currentPageGroup=e},expression:"currentPageGroup"}})],1)])]),t._v(" "),["teacher"].includes(t.role)?n("div",{staticClass:"card"},[n("div",{staticClass:"card-body"},[n("h4",{staticClass:"header-title mb-3"},[t._v("My lessons")]),t._v(" "),n("div",{staticClass:"table-responsive"},[n("table",{staticClass:"table table-centered mb-0"},[t._m(0),t._v(" "),n("tbody",t._l(t.myLessons,(function(e){return n("tr",{key:e.id},[n("td",{staticClass:" font-13 color-primary text-underline"},[n("nuxt-link",{attrs:{to:"/groups/students/"+e.group}},[t._v(" "+t._s(e.group_name))])],1),t._v(" "),n("td",{staticClass:"text-muted font-13"},[t._v("\n                                "+t._s(e.branch_name)+"\n                            ")]),t._v(" "),n("td",{staticClass:"font-13"},[t._v("\n                                "+t._s(e.subject_name)+"\n                            ")]),t._v(" "),n("td",[t._v("\n                                "+t._s(e.is_main_teacher?"Main Teacher":"Secondary Teacher")+"\n                            ")]),t._v(" "),n("td",{staticClass:"text-muted font-13"},[t._v("\n                                "+t._s(e.academic_year)+"\n                            ")])])})),0)])])])]):t._e(),t._v(" "),n("b-modal",{attrs:{"no-close-on-backdrop":!0,size:"lg",title:"Link students to group","title-class":"font-18","body-class":"p-4"},scopedSlots:t._u([{key:"modal-footer",fn:function(e){var r=e.cancel;return[n("b-button",{attrs:{size:"md"},on:{click:function(t){return r()}}},[t._v(" Cancel ")]),t._v(" "),n("b-button",{attrs:{size:"md",variant:"success"},on:{click:function(e){return t.save()}}},[t._v(" Save ")])]}}]),model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[n("ValidationObserver",{ref:"form"},[n("div",{staticClass:"school-create-form"},[n("div",{staticClass:"item mr-2"},[n("ValidationProvider",{attrs:{rules:"required"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.errors;return[n("p",{staticClass:"mb-1"},[t._v("Select attachment group *")]),t._v(" "),n("b-select",{class:{invalid:r[0]},attrs:{type:"text"},model:{value:t.attach_form.group,callback:function(e){t.$set(t.attach_form,"group",e)},expression:"attach_form.group"}},t._l(t.rows.results,(function(e){return n("option",{key:e.id,domProps:{value:e.id}},[t._v("\n                                "+t._s(e.name)+"\n                            ")])})),0)]}}])})],1),t._v(" "),n("div",{staticClass:"d-flex w-full flex-1 mb-3"},[n("div",{staticClass:"item flex-1"},[n("p",{staticClass:"mb-1"},[t._v("Search student")]),t._v(" "),n("b-input",{attrs:{placeholder:"Search student...",type:"text"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.getStudents.apply(null,arguments)}},model:{value:t.search_student,callback:function(e){t.search_student=e},expression:"search_student"}})],1),t._v(" "),n("div",{staticClass:"item d-flex"},[n("button",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"mt-auto btn btn-clear",attrs:{title:"Clear filter"},on:{click:function(e){t.search_student=null,t.getStudents()}}},[n("i",{staticClass:"mdi mdi-broom text-lg-center"})])])]),t._v(" "),n("div",{staticClass:"item"},[n("ValidationProvider",{attrs:{rules:"required"}},[n("p",{staticClass:"mb-1"},[t._v("Choose not attached students:")]),t._v(" "),n("b-form-group",{scopedSlots:t._u([{key:"default",fn:function(e){var r=e.ariaDescribedby;return[n("b-form-checkbox-group",{attrs:{"aria-describedby":r,name:"students-1",stacked:""},model:{value:t.attach_form.student,callback:function(e){t.$set(t.attach_form,"student",e)},expression:"attach_form.student"}},t._l(t.students.results,(function(e){return n("b-form-checkbox",{key:e.id,staticClass:"mb-1",attrs:{value:e.id}},[t._v("\n                                    "+t._s(t._f("fio")(e))+"\n                                ")])})),1)]}}])}),t._v(" "),n("b-pagination",{attrs:{"total-rows":t.totalRows,"per-page":10},on:{change:t.pageChanged},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1)],1)])])],1),t._v(" "),n("b-modal",{attrs:{size:"lg",id:"semester-view-modal",title:"Add Class","no-close-on-backdrop":!0},scopedSlots:t._u([{key:"modal-footer",fn:function(e){var r=e.cancel;return[n("b-button",{attrs:{size:"md",variant:"success"},on:{click:function(e){return t.editGroup()}}},[t._v(" Save ")]),t._v(" "),n("b-button",{attrs:{size:"md"},on:{click:function(t){return r()}}},[t._v(" Close ")])]}}]),model:{value:t.showClassModal,callback:function(e){t.showClassModal=e},expression:"showClassModal"}},[n("ValidationObserver",{ref:"group"},[n("div",{staticClass:"school-create-form"},[n("div",{staticClass:"row"},["pre-school"===t.getNameOf(t.group.grade,t.dic_grade)?n("div",{staticClass:"col-md-12"},[n("div",{staticClass:"item"},[n("ValidationProvider",{attrs:{rules:"required"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.errors;return[n("p",{staticClass:"mb-1"},[t._v("Branch *")]),t._v(" "),n("b-select",{class:{invalid:r[0]},model:{value:t.group.branch,callback:function(e){t.$set(t.group,"branch",e)},expression:"group.branch"}},t._l(t.dic_branch,(function(t){return n("option",{key:t.id,attrs:{label:t.short_name},domProps:{value:t.id}})})),0)]}}],null,!1,2243171879)})],1),t._v(" "),n("div",{staticClass:"item"},[n("ValidationProvider",{attrs:{rules:"required"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.errors;return[n("p",{staticClass:"mb-1"},[t._v("Name *")]),t._v(" "),n("b-input",{class:{invalid:r[0]},attrs:{type:"text"},model:{value:t.group.name,callback:function(e){t.$set(t.group,"name",e)},expression:"group.name"}})]}}],null,!1,3913984395)})],1)]):t._e(),t._v(" "),n("div",{staticClass:"col-md-6"},[n("div",{staticClass:"item"},[n("ValidationProvider",{attrs:{rules:"required"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.errors;return[n("p",{staticClass:"mb-1"},[t._v("Academic Year name *")]),t._v(" "),n("b-select",{class:{invalid:r[0]},attrs:{disabled:!t.edit,type:"text"},model:{value:t.group.academic_year,callback:function(e){t.$set(t.group,"academic_year",e)},expression:"group.academic_year"}},t._l(t.dic_academic_year,(function(e){return n("option",{key:e.id,attrs:{label:e.name},domProps:{value:e.id}},[t._v("\n                                        "+t._s(e.name)+"\n                                    ")])})),0)]}}])})],1),t._v(" "),n("div",{staticClass:"item"},[n("ValidationProvider",{attrs:{rules:"required"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.errors;return[n("p",{staticClass:"mb-1"},[t._v("Grade: *")]),t._v(" "),n("b-select",{class:{invalid:r[0]},on:{change:function(e){t.group.option=null}},model:{value:t.group.grade,callback:function(e){t.$set(t.group,"grade",e)},expression:"group.grade"}},t._l(t.dic_grade,(function(t){return n("option",{key:t.id,attrs:{label:t.name},domProps:{value:t.id}})})),0)]}}])})],1),t._v(" "),"pre-school"!==t.getNameOf(t.group.grade,t.dic_grade)?n("div",{staticClass:"item"},[n("ValidationProvider",{attrs:{rules:"required"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.errors;return[n("p",{staticClass:"mb-1"},[t._v("Options: *")]),t._v(" "),n("b-select",{class:{invalid:r[0]},attrs:{disabled:!t.group.grade},model:{value:t.group.option,callback:function(e){t.$set(t.group,"option",e)},expression:"group.option"}},t._l(t.DIC_grade_options,(function(t){return n("option",{key:t.id,attrs:{label:t.name},domProps:{value:t.id}})})),0)]}}],null,!1,1350355410)})],1):t._e()]),t._v(" "),n("div",{staticClass:"col-md-6"},["pre-school"!==t.getNameOf(t.group.grade,t.dic_grade)?n("div",{staticClass:"item"},[n("ValidationProvider",{attrs:{rules:"required"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.errors;return[n("p",{staticClass:"mb-1"},[t._v("Branch *")]),t._v(" "),n("b-select",{class:{invalid:r[0]},on:{change:t.getTeachers},model:{value:t.group.branch,callback:function(e){t.$set(t.group,"branch",e)},expression:"group.branch"}},t._l(t.dic_branch,(function(t){return n("option",{key:t.id,attrs:{label:t.short_name},domProps:{value:t.id}})})),0)]}}],null,!1,3283083811)})],1):t._e(),t._v(" "),n("div",{staticClass:"item"},[n("ValidationProvider",{attrs:{rules:"required"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.errors;return[n("p",{staticClass:"mb-1"},[t._v("Language: *")]),t._v(" "),n("b-select",{class:{invalid:r[0]},model:{value:t.group.education_language,callback:function(e){t.$set(t.group,"education_language",e)},expression:"group.education_language"}},t._l(t.dic_language,(function(t){return n("option",{key:t.id,attrs:{label:t.name},domProps:{value:t.id}})})),0)]}}])})],1),t._v(" "),n("div",{staticClass:"item"},[n("p",{staticClass:"mb-1"},[t._v("Class Teacher:")]),t._v(" "),n("b-select",{model:{value:t.group.teacher,callback:function(e){t.$set(t.group,"teacher",e)},expression:"group.teacher"}},t._l(t.DIC_teacher,(function(e){return n("option",{key:e.id,attrs:{label:t._f("fio")(e)},domProps:{value:e.id}})})),0)],1)])]),t._v(" "),n("div",{staticClass:"item"},[n("p",{staticClass:"mb-1"},[t._v("Description")]),t._v(" "),n("b-textarea",{attrs:{type:"text"},model:{value:t.group.description,callback:function(e){t.$set(t.group,"description",e)},expression:"group.description"}})],1)])])],1)],1)}),[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("thead",{staticClass:"font-13 bg-light text-muted"},[r("tr",[r("th",{staticClass:"font-weight-medium",staticStyle:{width:"140px"}},[t._v("\n                                Grade (Class)\n                            ")]),t._v(" "),r("th",{staticClass:"font-weight-medium"},[t._v("Branch")]),t._v(" "),r("th",{staticClass:"font-weight-medium"},[t._v("Subject")]),t._v(" "),r("th",{staticClass:"font-weight-medium"},[t._v("Teacher Type")]),t._v(" "),r("th",{staticClass:"font-weight-medium"},[t._v("Academic year")])])])}],!1,null,null,null);e.default=component.exports;installComponents(component,{PageHeader:r(837).default})},837:function(t,e,r){"use strict";r.r(e);var n=r(35),o={components:{},props:{title:{type:String,default:""},items:{type:Array,default:function(){return[]}}},computed:Object(n.c)(["layout"])},l=r(16),component=Object(l.a)(o,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"row"},[r("div",{staticClass:"col-12"},[r("div",{staticClass:"page-title-box",class:{"page-title-box-alt":"vertical"!==t.layout.layoutType&&"two-column"!==t.layout.layoutType}},[r("h4",{staticClass:"page-title"},[t._v(t._s(t.title))]),t._v(" "),r("div",{staticClass:"page-title-right"},[r("b-breadcrumb",{staticClass:"m-0",attrs:{items:t.items}})],1)])])])}),[],!1,null,null,null);e.default=component.exports},839:function(t,e,r){t.exports=r.p+"img/pen.8d1d161.svg"}}]);