(window.webpackJsonp=window.webpackJsonp||[]).push([[185,41],{1306:function(t,e,n){"use strict";n.r(e);n(7),n(9),n(6),n(10);var r=n(11),l=n(0),o=(n(61),n(22),n(4),n(2),n(8),n(35));function c(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function d(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?c(Object(source),!0).forEach((function(e){Object(l.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):c(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var f={head:function(){return{title:"".concat(this.title," | MIS tbteam.uz")}},data:function(){return{selectedTeachersList:[],allTeachersList:[],show_sms_send_dialog:!1,show:!1,loading:!1,data:{},current_course:null,courses:[],title:"Employees",items:[{text:"Employees",active:!0}],currentPage:1,perPage:10,pageOptions:[10,25,50,100],filter:{},filterOn:[],sortBy:"age",sortDesc:!1,fields:[{label:"#",key:"index",sortable:!1},{label:"Full Name",key:"full_name",sortable:!1},{label:"Branch",key:"employee_branch",sortable:!1},{label:"Phone",key:"phone",sortable:!1},{label:"Login",key:"login",sortable:!1},{label:"",key:"actions",sortable:!1}]}},watch:{currentPage:function(t){this.__GET()}},computed:d(d({},Object(o.b)("dictionary",["dic_branch","dic_role"])),{},{totalRows:function(){return this.data.count},role:function(){var t;return null===(t=this.$store.state.auth.user)||void 0===t?void 0:t.role.name}}),created:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.__GET();case 2:t.getAllTeacher();case 3:case"end":return e.stop()}}),e)})))()},methods:{sendSMS:function(){var t=this,data=[];this.selectedTeachersList.filter((function(t){data.push({user:t})})),this.loading=!0,this.$axios({method:"POST",url:"/send_sms/",data:data}).then((function(e){t.$Swal.fire({title:"SMS was sended!",type:"success"})})).catch((function(e){var n=e.response.data,r=Object.keys(n),l="string"==typeof n[r[0]]?n[r[0]]:n[r[0]][0];t.$Swal.fire({title:"Error",text:l||"error has occurred",type:"error"})})).finally((function(){t.loading=!1}))},selectAll:function(){var a=[];this.allTeachersList.filter((function(t){a.push(t.id)})),this.selectedTeachersList=a},getAllTeacher:function(){var t=this;this.$axios.get("/teachers/").then((function(e){t.allTeachersList=e.data}))},__GET:function(){var t=this;this.loading=!0,this.$axios({method:"GET",params:d(d({},this.filter),{page:this.currentPage}),url:"/employee/"}).then((function(e){t.data=e.data})).finally((function(){t.loading=!1}))},onFiltered:function(t){this.currentPage=1},rmItem:function(t){var e=this;this.$Swal.fire({title:"Do you sure you want to remove this employee?",type:"warning",showCancelButton:!0,confirmButtonText:"Delete!",cancelButtonText:"Cancel!",confirmButtonClass:"btn btn-danger mt-2",cancelButtonClass:"btn btn-primary ml-2 mt-2",buttonsStyling:!1}).then((function(n){n.value&&(e.loading=!0,e.$axios.delete("/employee/".concat(t,"/")).then((function(t){e.__GET(),e.$Swal.fire({title:"Deleted!",type:"info"})})).catch((function(t){var n=t.response.data,r=Object.keys(n),l="string"==typeof n[r[0]]?n[r[0]]:n[r[0]][0];e.$Swal.fire({title:"Error",text:l||"error has occurred",type:"error"})})).finally((function(){e.loading=!1})))}))}},middleware:"auth"},m=n(16),component=Object(m.a)(f,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[n("PageHeader",{attrs:{title:t.title,items:t.items}}),t._v(" "),n("div",{staticClass:"pb-2 w-full d-flex"},[n("div",{staticClass:"ml-auto"},[["super_admin"].includes(t.role)?n("button",{staticClass:"btn ml-auto text-white btn-primary mr-2",on:{click:function(e){t.show_sms_send_dialog=!0}}},[t._v("\n        Send Login/Password by sms\n      ")]):t._e(),t._v(" "),["branch_admin"].includes(t.role)?n("button",{staticClass:"btn ml-auto text-white btn-success",on:{click:function(e){return t.$router.push("/employees/add")}}},[n("i",{staticClass:"mdi mdi-plus-circle mr-1"}),t._v("\n        Add new Employee\n      ")]):t._e()])]),t._v(" "),n("div",{staticClass:"card"},[n("div",{staticClass:"card-body"},[n("div",{staticClass:"d-flex"},[n("div",{staticClass:"item mr-2"},[n("p",{staticClass:"mb-1"},[t._v("Choose branch")]),t._v(" "),n("b-select",{staticStyle:{width:"200px"},on:{change:function(e){return t.__GET()}},model:{value:t.filter.branch,callback:function(e){t.$set(t.filter,"branch",e)},expression:"filter.branch"}},[n("option",{domProps:{value:null}},[t._v("All branches")]),t._v(" "),t._l(t.dic_branch,(function(e){return n("option",{key:e.id,attrs:{label:e.short_name},domProps:{value:e.id}},[t._v("\n              "+t._s(e.short_name)+"\n            ")])}))],2)],1),t._v(" "),n("div",{staticClass:"item"},[n("p",{staticClass:"mb-1"},[t._v("Select Role")]),t._v(" "),n("b-select",{staticStyle:{width:"200px"},on:{change:function(e){return t.__GET()}},model:{value:t.filter.role,callback:function(e){t.$set(t.filter,"role",e)},expression:"filter.role"}},[n("option",{domProps:{value:null}},[t._v("All Roles")]),t._v(" "),t._l(t.dic_role,(function(e){return n("option",{key:e.id,attrs:{label:e.name},domProps:{value:e.id}},[t._v("\n              "+t._s(e.name)+"\n            ")])}))],2)],1),t._v(" "),n("div",{staticClass:"item d-flex"},[n("button",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"mt-auto btn btn-clear",attrs:{title:"Clear filter"},on:{click:function(e){t.filter={},t.__GET()}}},[n("i",{staticClass:"mdi mdi-broom text-lg-center"})])])])])]),t._v(" "),n("div",{staticClass:"row"},[n("div",{staticClass:"col-12"},[n("div",{staticClass:"card"},[n("div",{staticClass:"card-body"},[n("h4",{staticClass:"header-title"},[t._v("\n            "+t._s(t.$t("Employees"))+" ("+t._s(t.totalRows)+")\n          ")]),t._v(" "),n("p",{staticClass:"text-muted font-13 mb-4"}),t._v(" "),n("div",{staticClass:"row mb-md-2"},[n("div",{staticClass:"col-sm-12"},[n("div",{staticClass:"dataTables_filter text-md-right",attrs:{id:"tickets-table_filter"}},[n("label",{staticClass:"d-inline-flex align-items-center"},[t._v("\n                  Search:\n                  "),n("b-form-input",{staticClass:"form-control form-control-sm ml-2",attrs:{type:"search",placeholder:"Search..."},on:{keyup:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.currentPage=1,t.__GET()}},model:{value:t.filter.search,callback:function(e){t.$set(t.filter,"search",e)},expression:"filter.search"}})],1)])])]),t._v(" "),n("div",{staticClass:"table-responsive mb-0"},[t.loading?n("div",{staticClass:"card-disabled"},[t._m(0)]):t._e(),t._v(" "),n("b-table",{attrs:{items:t.data.results,fields:t.fields,responsive:"sm","per-page":t.perPage,"sort-by":t.sortBy,"sort-desc":t.sortDesc,filter:t.filter,"filter-included-fields":t.filterOn},on:{"update:sortBy":function(e){t.sortBy=e},"update:sort-by":function(e){t.sortBy=e},"update:sortDesc":function(e){t.sortDesc=e},"update:sort-desc":function(e){t.sortDesc=e},filtered:t.onFiltered},scopedSlots:t._u([{key:"cell(index)",fn:function(data){return[t._v("\n                "+t._s(10*(t.currentPage-1)+data.index+1)+"\n              ")]}},{key:"cell(full_name)",fn:function(data){return[n("nuxt-link",{attrs:{to:"/employees/info/"+data.item.id}},[n("u",[t._v(t._s(t._f("fio")(data.item)))])])]}},{key:"cell(phone)",fn:function(data){return[t._v("\n                "+t._s(t._f("phone")(data.item.phone))+"\n              ")]}},{key:"cell(employee_branch)",fn:function(data){return[t._v("\n                "+t._s(data.item.employee_branch?data.item.employee_branch.map((function(t){return t.short_name})).join(", "):"")+"\n              ")]}},{key:"cell(actions)",fn:function(data){return[n("ul",{staticClass:"list-inline table-action m-0"},[n("li",{staticClass:"list-inline-item",on:{click:function(e){return t.$router.push("/employees/add/"+data.item.id)}}},[n("a",{staticClass:"action-icon px-1",attrs:{href:"javascript:void(0);"}},[n("i",{staticClass:"mdi mdi-pencil"})])]),t._v(" "),n("li",{staticClass:"list-inline-item",on:{click:function(e){return t.rmItem(data.item.id)}}},[n("a",{staticClass:"action-icon px-1",attrs:{href:"javascript:void(0);"}},[n("i",{staticClass:"mdi mdi-delete"})])])])]}}])})],1),t._v(" "),n("div",{staticClass:"row"},[n("div",{staticClass:"col"},[n("div",{staticClass:"dataTables_paginate paging_simple_numbers float-right"},[n("ul",{staticClass:"pagination pagination-rounded mb-0"},[n("b-pagination",{attrs:{"total-rows":t.totalRows,"per-page":t.perPage},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1)])])])])])])]),t._v(" "),n("b-modal",{attrs:{size:"lg",id:"emp-view-modal",title:"User info"},scopedSlots:t._u([{key:"modal-footer",fn:function(e){var r=e.cancel;return[n("b-button",{attrs:{size:"md"},on:{click:function(t){return r()}}},[t._v(" Close ")])]}}]),model:{value:t.show,callback:function(e){t.show=e},expression:"show"}}),t._v(" "),n("b-modal",{attrs:{size:"lg",id:"emp-view-modal",title:"User info"},scopedSlots:t._u([{key:"modal-footer",fn:function(e){var r=e.cancel;return[n("b-button",{attrs:{variant:"primary"},on:{click:t.selectAll}},[t._v("Select all")]),t._v(" "),n("b-button",{attrs:{size:"md"},on:{click:function(t){return r()}}},[t._v(" Cancel ")]),t._v(" "),n("b-button",{attrs:{size:"md",variant:"success"},on:{click:function(e){return t.sendSMS()}}},[t._v("\n        Send SMS\n      ")])]}}]),model:{value:t.show_sms_send_dialog,callback:function(e){t.show_sms_send_dialog=e},expression:"show_sms_send_dialog"}},[n("b-form-checkbox-group",{attrs:{stacked:""},model:{value:t.selectedTeachersList,callback:function(e){t.selectedTeachersList=e},expression:"selectedTeachersList"}},t._l(t.allTeachersList,(function(e,r){return n("b-checkbox",{key:e.id,attrs:{value:e.id,label:t._f("fio")(e)}},[n("span",[t._v(t._s(r+1)+". ")]),t._v(t._s(t._f("fio")(e))+"\n        "),n("span",{staticClass:"ml-6"},[t._v(" | "+t._s(e.login))])])})),1)],1)],1)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"card-portlets-loader"},[e("div",{staticClass:"spinner-border text-primary m-2",attrs:{role:"status"}})])}],!1,null,null,null);e.default=component.exports;installComponents(component,{PageHeader:n(837).default})},837:function(t,e,n){"use strict";n.r(e);var r=n(35),l={components:{},props:{title:{type:String,default:""},items:{type:Array,default:function(){return[]}}},computed:Object(r.c)(["layout"])},o=n(16),component=Object(o.a)(l,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"row"},[n("div",{staticClass:"col-12"},[n("div",{staticClass:"page-title-box",class:{"page-title-box-alt":"vertical"!==t.layout.layoutType&&"two-column"!==t.layout.layoutType}},[n("h4",{staticClass:"page-title"},[t._v(t._s(t.title))]),t._v(" "),n("div",{staticClass:"page-title-right"},[n("b-breadcrumb",{staticClass:"m-0",attrs:{items:t.items}})],1)])])])}),[],!1,null,null,null);e.default=component.exports}}]);